TASK_NM="${taskNo}"; RESRC="${resources}"; BCKP_DIR="${path.backup}"; DUMP_DIR="${path.dump}"; DEPL_DIR="${path.deploy}"; DIR_BKUP=""; if [ ! -d "$TASK_NM" ]; then echo "ERROR : $TASK_NM Not Exists"; exit 1; fi; cd $TASK_NM; IFS=","; if [ -n "$RESRC" ]; then if [ ! -d "$DEPL_DIR" ]; then echo "ERROR : $DEPL_DIR Not Exists"; exit 1; fi; if [ -n "$BCKP_DIR" ]; then if [ ! -d "$BCKP_DIR" ]; then echo "ERROR : BACKUP DIRECTORY not found : $BCKP_DIR"; exit 1; elif [ ! -d "$BCKP_DIR/$TASK_NM" ]; then mkdir "$BCKP_DIR/$TASK_NM" 2>/dev/null; fi; DIR_BKUP="$BCKP_DIR/$TASK_NM"; else if [ ! -d "backup" ]; then mkdir "backup" 2>/dev/null; fi; DIR_BKUP="backup"; fi; stpBk=0; for src in $RESRC; do src_nm=`echo "$src" | cut -d'.' -f1` 2>/dev/null; src_ext=`echo "$src" | cut -d'.' -f3` 2>/dev/null; if [ "$stpBk" = "0" ]; then if [ "$src_ext" != "gz" -a -f "$DEPL_DIR/$src" ]; then cp "$DEPL_DIR/$src" "$DIR_BKUP" 2>/dev/null; if [ $? -ne 0 ]; then echo "WARN : Failed to Backup $DEPL_DIR/$src"; fi; rm -rf "$DEPL_DIR/$src" 2>/dev/null; if [ $? -ne 0 ]; then echo "ERROR : Failed to remove $src in $DEPL_DIR";exit 1; fi; echo "INFO : Backup $DEPL_DIR/$src [DONE]"; elif [ "$src_ext" = "gz" -a -d "$DEPL_DIR" ]; then mkdir "$DIR_BKUP/$src_nm" 1>&2 2>/dev/null; cp -r $DEPL_DIR/* "$DIR_BKUP/$src_nm" 2>/dev/null; rm -rf $DEPL_DIR/* 2>/dev/null; if [ $? -ne 0 ]; then echo "ERROR : Failed to remove $src in $DEPL_DIR";exit 1; fi; echo "INFO : Backup $DEPL_DIR [DONE]"; stpBk=1; else echo "WARN : Failed to backup $DEPL_DIR/$src due to resource not exists"; fi; fi; done; for src in $RESRC; do src_ext=`echo "$src" | cut -d'.' -f3`; if [ -e "$src" ]; then if [ "$src_ext" != "gz" ]; then cp "$src" "$DEPL_DIR" 2>/dev/null; if [ $? -ne 0 ]; then echo "ERROR : Failed to deploy $src to $DEPL_DIR"; exit 1; fi; echo "INFO : Deploy $src [DONE]"; else tar xf $src -C $DEPL_DIR 2>/dev/null; if [ $? -ne 0 ]; then echo "ERROR : Failed to deploy $src to $DEPL_DIR"; exit 1; fi; echo "INFO : Deploy and extract $src [DONE]"; fi; else echo "ERROR : Failed to deploy $src due to resource not exists"; exit 1; fi; done; fi; if [ -n "$DUMP_DIR" ]; then for dmp in $DUMP_DIR; do if [ -d "$dmp" ]; then rm -rf $dmp/* 1>&2 2>/dev/null; rc=$?; if [ $rc -ne 0 ]; then echo "WARN : Failed to delete $dmp , Code : $rc"; else echo "INFO : Delete $dmp successfully"; fi elif [ -f "$dmp" ]; then rm -rf "$dmp" 1>&2 2>/dev/null; rc=$?; if [ $rc -ne 0 ]; then echo "WARN : Failed to delete $dmp , Code : $rc"; else echo "INFO : Delete $dmp successfully"; fi else echo "WARN : Failed to delete $dmp due to not exists"; fi; done; fi; exit 0; 